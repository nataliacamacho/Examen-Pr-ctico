<div class="admin-productos">
  <h2>Gestión de Productos</h2>

  @if (mensaje) {
    <div class="mensaje" [class.exito]="mensaje.includes('exitosamente')">
      {{ mensaje }}
    </div>
  }

  <button class="btn-primary" (click)="abrirFormulario()" [disabled]="loading">
    + Nuevo Producto
  </button>

  @if (formVisible) {
    <div class="modal-overlay" (click)="cerrarFormulario()">
      <div class="modal" (click)="$event.stopPropagation()">
        <h3>{{ productoEditando ? 'Editar' : 'Crear' }} Producto</h3>

        <div class="form-group">
          <label>Nombre *</label>
          <input [(ngModel)]="formData.nombre" placeholder="Nombre del producto" />
        </div>

        <div class="form-group">
          <label>Descripción</label>
          <textarea [(ngModel)]="formData.descripcion" placeholder="Descripción"></textarea>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label>Precio *</label>
            <input type="number" [(ngModel)]="formData.precio" placeholder="0.00" step="0.01" />
          </div>

          <div class="form-group">
            <label>Stock</label>
            <input type="number" [(ngModel)]="formData.stock" placeholder="0" />
          </div>
        </div>

        <div class="form-group">
          <label>URL Imagen</label>
          <input [(ngModel)]="formData.imagen" placeholder="https://..." />
        </div>

        <div class="form-group">
          <label>Estado</label>
          <select [(ngModel)]="formData.vigencia">
            <option value="activo">Activo</option>
            <option value="inactivo">Inactivo</option>
          </select>
        </div>

        <div class="form-actions">
          <button class="btn-guardar" (click)="guardarProducto()" [disabled]="loading">
            {{ loading ? 'Guardando...' : 'Guardar' }}
          </button>
          <button class="btn-cancelar" (click)="cerrarFormulario()" [disabled]="loading">
            Cancelar
          </button>
        </div>
      </div>
    </div>
  }

  <div class="productos-tabla">
    <table>
      <thead>
        <tr>
          <th>Nombre</th>
          <th>Precio</th>
          <th>Stock</th>
          <th>Vigencia</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        @for (prod of productos(); track prod.id) {
          <tr [class.inactivo]="estaInactivo(prod)">
            <td>{{ prod.nombre }}</td>
            <td>${{ prod.precio | number:'1.2-2' }}</td>
            <td>{{ prod.stock }}</td>
            <td>{{ prod.estado || prod.vigencia || 'activo' }}</td>
            <td>
              <button class="btn-editar" (click)="editarProducto(prod.id)" [disabled]="loading">
                Editar
              </button>
              
            </td>
          </tr>
        }
      </tbody>
    </table>
    @if (productos().length === 0) {
      <div class="sin-productos">
        No hay productos registrados.
      </div>
    }
  </div>
</div>
